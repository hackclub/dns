#!/bin/bash

# Get list of zones (and thus filenames)
yq '.zones | keys | .[]' config/production.yaml | while read -r zone; do
  # For each file...
  FILENAME="$zone"yaml
  echo -e "\nFormatting $FILENAME"

  # Print a diff (if changes are made)
  yq -MP 'sort_keys(.)' $FILENAME >$FILENAME.tmp
  diff -u $FILENAME $FILENAME.tmp | diffstat -q
  rm $FILENAME.tmp

  # Apply the changes
  yq -iMP 'sort_keys(.)' $FILENAME
  # - i: in-place
  # - M: no color
  # - P: pretty print
done
